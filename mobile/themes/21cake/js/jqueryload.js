function showAndroidToast(e){android.goPopluarizeDetailActivity()}function refreshAll(){var e=mebook.getInViewportList(),t=[],n=0,r=e.length;for(n;n<r;n++){var i={apkid:mebook.getSoftData(e[n]).apkid,version_name:mebook.getSoftData(e[n]).version_name};t.push(i)}mebook.cmd.getStatus(t)}function onStatusReturn(e){var e=typeof e=="string"?JSON.parse(e):e;for(var t in e){var n=mebook.getSoftId(t),r=e[t].status;mebook.ui.chgStat(n,r)}}var mebook=mebook||{};mebook.mebData={},mebook.mebSids={},mebook.freshMebData=function(e){function t(e){var t=e.length,n=0,r={},i={};if(!t)return{};for(n;n<t;n++)r[e[n].soft_id]=e[n],i[e[n].apkid]=e[n].soft_id;return[r,i]}if(!window.ebookData||!ebookData.length)return;$.extend(mebook.mebData,t(e||ebookData)[0]),$.extend(mebook.mebSids,t(e||ebookData)[1])},mebook.getSoftData=function(e){return e?mebook.mebData[e]||{}:{}},mebook.getSoftId=function(e){return e?mebook.mebSids[e]||0:{}},mebook.ui={stats:["\u5b89\u88c5","\u9605\u8bfb","\u9605\u8bfb","\u4e0b\u8f7d\u4e2d","\u5b89\u88c5\u4e2d","\u4e0b\u8f7d"],klass:["btn_inst","btn_read","btn_read","btn_downing","btn_insting","btn_down"],chgStat:function(e,t){var n=e instanceof jQuery?e:$("li.li-"+e).find("a.dbtn");n.attr("class","dbtn "+this.klass[t*1]).text(this.stats[t*1])}},$.belowthefold=function(e){var t=$(window).height()+$(window).scrollTop();return t<=$(e).offset().top},$.abovethetop=function(e){var t=$(window).scrollTop();return t>=$(e).offset().top+$(e).height()},$.inViewport=function(e){return!$.belowthefold(e)&&!$.abovethetop(e)},$.supportTouch=$.mobile.support.touch,mebook.getInViewportList=function(){var e=$("#bookList li"),t=[];return e.each(function(n){var r=e.eq(n);$.inViewport(r)&&(t.push(r.attr("sid")),mebook.loadImg(r))}),t},mebook.loadImg=function(e){if(e.find("img[_src]").length){var t=e.find("img[_src]"),n=t.attr("_src");t.attr("src",n).load(function(){t.removeAttr("_src")})}},mebook.cmd={down:function(e){var t=JSON.stringify(mebook.getSoftData(e));try{AndroidWebview.downloadApp(t)}catch(n){alert("AndroidWebview.downloadApp("+t+")")}},read:function(e){var t=mebook.getSoftData(e),n=JSON.stringify({apkid:t.apkid});try{AndroidWebview.launchApp(n)}catch(r){alert("AndroidWebview.launchApp("+n+")")}},inst:function(e){var t=mebook.getSoftData(e),n=JSON.stringify({apkid:t.apkid});try{AndroidWebview.installApp(n)}catch(r){alert("AndroidWebview.installApp("+n+")")}},goSid:function(e){var t=mebook.getSoftData(e),n=JSON.stringify($.extend(t,{page:"detail"}));try{AndroidWebview.gotoPage(n)}catch(r){alert("AndroidWebview.gotoPage("+n+")")}},goList:function(e,t){var n="http://zsall.mobilem.360.cn/mobileebook/list/kw/"+e,r=n+"/order/daytotal";latesturl=n+"/order/update_time";var i={page:"list",hoturl:r,latesturl:latesturl,name:e,csid:t};i=JSON.stringify(i);try{AndroidWebview.gotoPage(i)}catch(s){alert("AndroidWebview.gotoPage("+i+")")}},goUrl:function(e){if(!e)return;try{AndroidWebview.openPage(e)}catch(t){alert("AndroidWebview.openPage("+e+")")}},getStatus:function(e){var t=JSON.stringify(e);try{AndroidWebview.getAppStatus(t,"onStatusReturn")}catch(n){}}},mebook.pageActions=function(){var e=$("#bookList"),t=$.supportTouch?"tap":"click",n=$.supportTouch?"taphold":"focus";e.delegate("li",t,function(e){var t=$(this);if(!$(e.target).is("a")){t.addClass("taphlt"),this.className=this.className;var n=t.attr("sid");setTimeout(function(){t.removeClass("taphlt"),mebook.cmd.goSid(n)},50)}}),$(document).on("touchend",function(){}),$("a.dbtn",e).live(t,function(){var e=$(this).attr("sid")||$(this).parents("li").attr("sid"),t=$(this).attr("class"),n=mebook.ui.klass;if(/ing/.test(t))return;/btn_down/.test(t)?(mebook.cmd.down(e),mebook.ui.chgStat(e,3)):/btn_read/.test(t)?mebook.cmd.read(e):/btn_inst/.test(t)&&(mebook.cmd.inst(e),mebook.ui.chgStat(e,4))}),$("[data-act]").on(t,function(){var e=$(this),t=e.data("act"),n,r;if(t=="goSid"){n=e.attr("sid")||e.parents("li")&&e.parents("li").attr("sid");if(!n){alert("\u7f3a\u5c11sid");return}mebook.cmd.goSid(n)}if(t=="goUrl"){r=e.attr("rel")||e.parents("li")&&e.parents("li").attr("rel");if(!r){alert("\u7f3a\u5c11rel");return}mebook.cmd.goUrl(r)}if(t=="goList"){cat=e.attr("cat"),cid=e.attr("cid")||"";if(!cat){alert("\u7f3a\u5c11cat");return}mebook.cmd.goList(cat,cid)}})};var dftConfig={list:"#bookList",loadTips:"#btmloader",dataUrl:"/Mobileebook/list/n/1/",loadNum:10,threshold:0,eventType:$.supportTouch?"scrollstop":"scroll",loadDealy:50},swipeLoad=function(e){var t={},n=e(window).height(),r,i,s,o,u=1,a=!1,f=null;return t.init=function(n){if(!n)return;i=n,r=e(i.list);if(!r.length)return;s=e(i.loadTips);if(!s.length)return;t.bindAct()},t.bindAct=function(){e(window).bind(i.eventType,t.detectLoad)},t.unbindAct=function(){e(window).unbind(i.eventType,t.detectLoad)},t.stopDetect=function(){t.unbindAct(),s.hide()},t.getScrollTop=function(){var e,t=document;return t.documentElement&&t.documentElement.scrollTop?e=t.documentElement.scrollTop:t.body&&(e=t.body.scrollTop),e},t.belowthefold=function(r){var s=n+t.getScrollTop();return s<=e(r).offset().top-i.threshold},t.reachBottom=function(t){var n=e(window),t=t||0;return navigator.userAgent.indexOf("iPhone")!=-1&&(t=70),n.scrollTop()+n.height()+t>=document.body.scrollHeight},t.detectLoad=function(){if(a)return;var e=t.reachBottom(10);e&&(a=!0,setTimeout(t.getData,i.loadDealy))},t.getData=function(){u++,u>=window.pagecount&&t.stopDetect();var n=window.questType||i.dataUrl;questArgs.page=u,e.get(n,questArgs,function(e){e&&(t.onGetData(e),a=!1)})},t.onGetData=function(e){e=typeof e=="string"?JSON.parse(e):e,t.buildList(e),mebook.freshMebData(e)},t.buildList=function(n){function i(e){return e>=1e4?(e/1e4).toFixed(1):e}if(!n||!n.length){t.stopDetect();return}var s=0,o=n.length,u=[];for(s;s<o;s++){var a=n[s];u.push('<li class="box li-'+a.soft_id+'" sid="'+a.soft_id+'">'),u.push('<div class="book_icon"><img src="http://p19.qhimg.com/t015e7d1233fd0f44cf.gif" _src="'+a.logo_url+'"></div>'),u.push('<div class="book_info"><h1>'+(a.name_fixed||a.name)),a.day_download_times&&u.push('<span class="download_times">\u65e5\u4e0b\u8f7d'+i(a.day_download_times)+"\u6b21"),u.push("</h1><p>"+a.brief+"</p></div>"),u.push('<a href="#n" sid="'+a.soft_id+'" class="dbtn btn_down">\u4e0b\u8f7d</a></li>')}r.append(e(u.join("")))},t}($);mebook.kwview=function(){var e={},t,n,r,i;return e.init=function(){t=$("#kw_chg");if(!t.length)return;n=$("#kw_cloud div"),r=$("a",n),i=r.length,e.bindAct()},e.bindAct=function(){var n=$.supportTouch?"tap":"click";t.on(n,function(){e.randomShow()})},e.randomShow=function(){var e=0,t=[];for(e;e<20;e++)t.push(r.eq(Math.floor(Math.random()*i)));$(t).appendTo(n)},e}(),$(function(){var e=null;mebook.freshMebData(),mebook.pageActions(),swipeLoad.init(dftConfig),mebook.kwview.init(),$(window).on("scrollstop",function(){e&&(clearTimeout(e),e=null),e=setTimeout(refreshAll,1e3)}),$("#schForm").submit(function(){var e=$("#kw"),t=$.trim(e.val());return t||(e.addClass("error"),setTimeout(function(){e.removeClass("error")},1600)),!!t})});